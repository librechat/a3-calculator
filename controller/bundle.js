!function(e){var r={};function a(t){if(r[t])return r[t].exports;var l=r[t]={i:t,l:!1,exports:{}};return e[t].call(l.exports,l,l.exports,a),l.l=!0,l.exports}a.m=e,a.c=r,a.d=function(e,r,t){a.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},a.p="",a(a.s=5)}([function(e,r){e.exports={characters:["佐久間咲也","碓冰真澄","皆木綴","茅崎至","希特隆","皇天馬","瑠璃川幸","向坂椋","斑鳩三角","三好一成","攝津萬里","兵頭十座","七尾太一","伏見臣","古市左京","月岡紬","高遠丞","御影密","有栖川譽","雪白東"],redskill:[{name:"新生秋組",buff:1.5,members:["攝津萬里","兵頭十座","七尾太一","伏見臣","古市左京"]},{name:"組長們",buff:1.4,members:["佐久間咲也","皇天馬","攝津萬里","月岡紬"]},{name:"團內足球社",buff:1.3,members:["皆木綴","伏見臣","高遠丞"]},{name:"歌舞伎愛好者",buff:1.3,members:["希特隆","瑠璃川幸","高遠丞"]},{name:"歐華高中組",buff:1.3,members:["皇天馬","兵頭十座","七尾太一"]},{name:"痴心男孩",buff:1.1,members:["佐久間咲也","兵頭十座"]},{name:"雙親在國外",buff:1.1,members:["皇天馬","碓冰真澄"]},{name:"毒舌",buff:1.1,members:["碓冰真澄","瑠璃川幸"]},{name:"電玩部",buff:1.1,members:["茅崎至","攝津萬里"]},{name:"垃圾食物愛好者",buff:1.1,members:["茅崎至","七尾太一"]},{name:"運動神經發達怪物",buff:1.1,members:["斑鳩三角","御影密"]},{name:"青梅竹馬",buff:1.1,members:["月岡紬","高遠丞"]}],blueskill:[{name:"新生春組",buff:1.5,members:["佐久間咲也","碓冰真澄","皆木綴","茅崎至","希特隆"]},{name:"新生冬組",buff:1.5,members:["月岡紬","高遠丞","御影密","有栖川譽","雪白東"]},{name:"團內麻將社",buff:1.4,members:["希特隆","三好一成","古市左京","雪白東"]},{name:"花咲學園組",buff:1.3,members:["佐久間咲也","碓冰真澄","攝津萬里"]},{name:"孑然一身",buff:1.3,members:["佐久間咲也","御影密","雪白東"]},{name:"一瞑大一寸",buff:1.1,members:["碓冰真澄","御影密"]},{name:"葉星大學組",buff:1.1,members:["皆木綴","伏見臣"]},{name:"擅長教人",buff:1.1,members:["茅崎至","月岡紬"]},{name:"表兄弟",buff:1.1,members:["向坂椋","兵頭十座"]},{name:"G的洗禮",buff:1.1,members:["七尾太一","高遠丞"]},{name:"前不良",buff:1.1,members:["古市左京","伏見臣"]},{name:"最年長組",buff:1.1,members:["古市左京","雪白東"]}],yellowskill:[{name:"新生夏組",buff:1.5,members:["皇天馬","瑠璃川幸","向坂椋","斑鳩三角","三好一成"]},{name:"甜食派",buff:1.4,members:["向坂椋","兵頭十座","御影密","雪白東"]},{name:"Trouble Makers",buff:1.3,members:["希特隆","斑鳩三角","有栖川譽"]},{name:"少女漫畫同好會",buff:1.3,members:["向坂椋","三好一成","古市左京"]},{name:"飛特族",buff:1.3,members:["斑鳩三角","月岡紬","雪白東"]},{name:"目標是相聲巨星",buff:1.1,members:["皆木綴","希特隆"]},{name:"團內文藝部",buff:1.1,members:["皆木綴","有栖川譽"]},{name:"討厭魚卵",buff:1.1,members:["茅崎至","有栖川譽"]},{name:"購物同伴",buff:1.1,members:["皇天馬","攝津萬里"]},{name:"聖芙羅拉中學組",buff:1.1,members:["瑠璃川幸","向坂椋"]},{name:"團內手工部",buff:1.1,members:["瑠璃川幸","伏見臣"]},{name:"汪汪搭檔",buff:1.1,members:["三好一成","七尾太一"]},{name:"藝術家氣質",buff:1.1,members:["三好一成","有栖川譽"]}],group:[["佐久間咲也","碓冰真澄","皆木綴","茅崎至","希特隆"],["皇天馬","瑠璃川幸","向坂椋","斑鳩三角","三好一成"],["攝津萬里","兵頭十座","七尾太一","伏見臣","古市左京"],["月岡紬","高遠丞","御影密","有栖川譽","雪白東"]]}},function(e,r){const a={count:"至少要有5張卡才能使用組隊功能",character_count:"重複角色太多",empty_character:"不能有空白角色",illegal_cardfile:"卡組資料格式錯誤",illegal_value:"卡片數值請用數字填入",illegal_star:"卡片星級請用數字填入，僅限1~4",illegal_dupe:"卡片突破請用數字填入，僅限0~4",illegal_character:"請填入正確角色名稱",illegal_name:"請用文字敘述卡片名稱",illegal_event:"倍卡格式錯誤"},t={colors:["red","blue","yellow"],team_template:{total:0,skillname:"無技能",skillbuff:1,groupbuff:1,members:[]},card_template:{id:-1,star:1,character:"",cardname:"",red:0,blue:0,yellow:0,event:!1,dupe:0},member_template:{id:-1,star:1,character:"",cardname:"",value:0,event:!1,dupe:0},warning:a};CheckNaturalNum=function(e){return void 0!=e&&!!(Number.isInteger(e)&&e>-1)},CopyByValue=function(e){return JSON.parse(JSON.stringify(e))},Arrangeable=function(e,r){if(e.length<5)return a.count;for(var t={},l=0;l<r.length;l++)t[r[l]]=0;for(l=0;l<e.length;l++){var n=e[l].character;if(""===n)return a.empty_character;if(void 0===t[n])return a.illegal_character;t[n]<3&&(0,t[n]++)}return null},IsLegal=function(e,r){if(void 0==e||null==e)return a.illegal_cardfile;if(e.constructor!==Array)return a.illegal_cardfile;for(var t={},l=0;l<r.length;l++)t[r[l]]=0;for(l=0;l<e.length;l++){if(!CheckNaturalNum(e[l].red)||!CheckNaturalNum(e[l].blue)||!CheckNaturalNum(e[l].yellow))return a.illegal_value;if(!CheckNaturalNum(e[l].star)||e[l].star>4)return a.illegal_value;if(!CheckNaturalNum(e[l].dupe)||e[l].dupe>4)return a.illegal_value;if("string"!=typeof e[l].character)return a.illegal_character;if(void 0===t[e[l].character])return a.illegal_character;if("string"!=typeof e[l].cardname)return a.illegal_name;if("boolean"!=typeof e[l].event)return a.illegal_event}return null},array_dupe=function(){for(var e=this.concat(),r=0;r<e.length;++r)for(var a=r+1;a<e.length;++a)e[r]===e[a]&&e.splice(a,1);return e},array_equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var r=0;r<this.length;r++){if(e[r]instanceof Array&&this[r]instanceof Array)return this[r].equals(e[r]);if(e[r]!==this[r])return!1}return!0},ExtendArray=function(){Array.prototype.dupe=array_dupe,Array.prototype.equals=array_equals},e.exports={CheckNaturalNum:CheckNaturalNum,CopyByValue:CopyByValue,ExtendArray:ExtendArray,Arrangeable:Arrangeable,IsLegal:IsLegal,Const:t}},function(e,r,a){var t=a(0),l=a(1);l.ExtendArray(),sort_cards=function(e,r,a,t){if(!(a>=t)){var l=e[a][r];1==e[a].event&&(l=e[a][r]*(1*e[a].dupe+2));for(var n=a,o=t+1;;){for(;n+1<=t&&card_greater(e[++n],r,l););for(;o-1>=a&&card_less(e[--o],r,l););if(!(n<o))break;var u=e[n];e[n]=e[o],e[o]=u}u=e[a];e[a]=e[o],e[o]=u,sort_cards(e,r,a,o-1),sort_cards(e,r,o+1,t)}},card_to_team=function(e,r){return{id:e.id,star:e.star,character:e.character,cardname:e.cardname,value:e[r],event:e.event,dupe:e.dupe}},card_greater=function(e,r,a){return!0===e.event?value=e[r]*(1*e.dupe+2):value=e[r],value>a},card_less=function(e,r,a){return!0===e.event?value=e[r]*(1*e.dupe+2):value=e[r],value<a},calculate_total=function(e,r,a){for(var l=0,n=1,o="",u=0;u<e.members.length;u++){var c=e.members[u].value;!0===e.members[u].event&&(c*=1*e.members[u].dupe+2),-1!==t.characters.indexOf(e.members[u].character)&&(l+=c)}for(var s=0,m=0;m<r.length;m++){var i=0,f=[];for(u=0;u<e.members.length;u++)-1===f.indexOf(e.members[u].character)&&-1!==r[m].members.indexOf(e.members[u].character)&&(i++,f.push(e.members[u].character));if(i==r[m].members.length&&s<3&&(n*=r[m].buff,o=0===o.length?r[m].name:o+"+"+r[m].name,3==++s))break}var d=0;if(-1!=a){var g=t.group[a];for(m=0;m<e.members.length;m++)-1!==g.indexOf(e.members[m].character)&&(d+=2.5)}return d=1+d/100,e.total=Math.floor(l*n*d),e.skillbuff=n.toFixed(3),e.groupbuff=d.toFixed(3),e.skillname=0===o.length?"無技能":o,e.total},arrange=function(e,r,a,n,o,u,c){var s=[];(a=a.filter(function(e){return 6!=e.members.length||-1!==e.members.indexOf(u.character)||!t.characters.indexOf(u.character)})).forEach(function(a){var t=l.CopyByValue(l.Const.team_template),n=!1;a.members.forEach(function(l){var c=r.findIndex(function(e){return e.character===l&&-1===o.indexOf(e.id)});if(-1!==c&&-1===o.indexOf(r[c].id)){var s=card_to_team(r[c],e);u.character===s.character&&(s.value<u.value||6===a.members.length)?n=!0:t.members.push(s)}}),a.members.length>t.members.length&&-1===t.members.indexOf(u.character)&&-1!==a.members.indexOf(u.character)&&(n=!0),(t.members.length===a.members.length&&t.members.length<6||n)&&(t.skillname=a.name,t.skillbuff=a.buff,s.push(t))}),s.push(l.CopyByValue(l.Const.team_template)),s.forEach(function(a){for(var t=0;a.members.length<5&&t<r.length;)-1===a.members.findIndex(function(e){return e.id==r[t].id})&&-1===o.indexOf(r[t].id)?a.members.push(card_to_team(r[t],e)):t++;a.members.push(u)});var m=-1,i=null;if(s.forEach(function(a){total=calculate_total(a,n,c);for(var t=!1,o=0;o<5;o++){for(var u=r.find(function(e){return e.id==a.members[o].id}),s=!0,f=0;f<l.Const.colors.length;f++)if(l.Const.colors[f]!=e&&u[l.Const.colors[f]]>u[e]){s=!1;break}if(s){t=!0;break}}total>m&&t&&(m=total,i=a)}),null!==i)for(var f=0;f<i.members.length;f++)o.push(i.members[f].id);else console.log(s);return i},multiple_skill=function(e,r){var a=0,t=r.length;do{for(var n=r.length,o=n-1;o>=a;o--)for(var u=o<t?o-1:t-1;u>=0;u--){var c=r[o],s=r[u],m=c.members.concat(s.members).dupe();if(m.length<=6)if(void 0===r.find(function(e){if(l.CopyByValue(e.members).sort().equals(m.sort())){var r=e.name.split("+"),a=c.name.split("+"),t=s.name.split("+"),n=a.concat(t).dupe();return n.length!==a.length+t.length||n.length===r.length}return!1})){var i=0;for(u=0;u<m.length;u++)if(c.members.indexOf(m[u])>-1&&s.members.indexOf(m[u])>-1){var f=m[u];m[u]=m[i],m[i]=f,i++}m.length===c.members.length&&o>=t&&(r.splice(o,1),o<n&&n--),m.length===s.members.length&&u>=t&&(r.splice(u,1),u<n&&n--),r.push({name:c.name+"+"+s.name,members:m,buff:c.buff*s.buff})}}a=n}while(a!==r.length);for(var d=r.length-1;d>=0;d--){(c=r[d].name.split("+")).length>3&&r.splice(d,1)}return r},e.exports={sort_cards:sort_cards,calculate_total:calculate_total,arrange:arrange,multiple_skill:multiple_skill,card_to_team:card_to_team}},function(e,r){toggle_alert=function(e,r,a){var t=angular.element(document.getElementById("arrangealert"));r?(e.warning_msg="",t.fadeOut()):(e.warning_msg=a,console.log(e.warning_msg),t.fadeIn())},e.exports={toggle_alert:toggle_alert}},function(e,r,a){var t=a(1),l=a(0),n=a(3),o=a(2);t.ExtendArray();var u=angular.module("A3Calculator",[]),c=new FileReader;u.controller("CardGroup",["$scope",function(e){e.characters=[],e.redskill=[],e.blueskill=[],e.yellowskill=[],e.redteam=null,e.blueteam=null,e.yellowteam=null,e.cards=[],e.teams={red:e.redteam,blue:e.blueteam,yellow:e.yellowteam},e.guests={yellow:null,red:null,blue:null},e.skill={},e.eventgroup=-1,e.color="gray",e.cardcount=5,e.groupstyle=3,e.warning_msg="",e.imagepath={red:"../resource/action-web.png",blue:"../resource/serious-web.png",yellow:"../resource/comedy-web.png",gray:""},e.init=function(){c.onload=function(r){var a,l=r.target.result;try{a=JSON.parse(l)}catch(r){return console.log(r),void n.toggle_alert(e,!1,t.Const.warning.illegal_cardfile)}var o=t.IsLegal(a,e.characters);if(console.log(o),n.toggle_alert(e,null===o,o),null===o){for(var u=(new Date).getTime(),c=0,s=0;s<a.length;s++)null==a[s].id&&(a[s].id=u+c,c++);e.cards=a,e.cardcount=a.length,e.$apply()}else e.$apply()};var r=t.CopyByValue(t.Const.card_template);r.id=0,e.cards.push(r);for(var a=0;a<3;a++){var o=t.Const.colors[a];e.guests[o]=t.CopyByValue(t.Const.member_template);for(var u=t.CopyByValue(t.Const.team_template),s=0;s<5;s++){var m=t.CopyByValue(t.Const.member_template);u.members.push(m)}u.members.push(t.CopyByValue(e.guests[o])),e.teams[o]=u}e.cardcount=e.cards.length,e.characters=l.characters,e.redskill=l.redskill,e.blueskill=l.blueskill,e.yellowskill=l.yellowskill,e.skill={red:e.redskill,blue:e.blueskill,yellow:e.yellowskill}},e.calculate=function(){var r=e.color;console.log(e.teams[r].members.length),o.calculate_total(e.teams[r],e.skill[r],e.eventgroup)},e.changecolor=function(r){e.color=r},e.changecardcount=function(){var r=e.cards.length;if((void 0==e.cardcount||null==e.cardcount||e.cardcount<1)&&(e.cardcount=1),r!=e.cardcount){e.cards.length=e.cardcount;var a=(new Date).getTime(),l=0;if(r<e.cards.length)for(var n=r;n<e.cards.length;n++)e.cards[n]=t.CopyByValue(t.Const.card_template),e.cards[n].id=a+l,l++}},e.autoarrangeall=function(){var r=t.Arrangeable(e.cards,e.characters);if(n.toggle_alert(e,null===r,r),null===r)for(var a=t.CopyByValue(e.cards),l=0;l<t.Const.colors.length;l++){var o=t.Const.colors[l];e.arrangebycolor(a,o)}},e.arrangebycolor=function(r,a){var l=t.CopyByValue(e.skill[a]),n=o.multiple_skill(a,l);o.sort_cards(r,a,0,r.length-1);var u=t.CopyByValue(e.guests[a]);e.teams[a]=o.arrange(a,r,n,e.skill[a],[],u,e.eventgroup)},e.clear=function(){e.cardcount=1,e.cards.length=1,e.cards[0]=t.CopyByValue(t.Const.card_template),e.cards[0].id=(new Date).getTime();for(var r=0;r<3;r++)e.guests[r]=t.CopyByValue(t.Const.card_template);angular.element(document.getElementsByName("cardfile")[0]).val(null)},e.download=function(){var r=new Date,a=(r.getMonth()+1).toString();1==a.length&&(a="0"+a);var t=r.getDate().toString();1==t.length&&(t="0"+t);var l="a3_cards_"+r.getFullYear()+a+t+".txt",n=JSON.stringify(e.cards),o=new Blob(["\ufeff",n]),u=document.createElement("a");u.setAttribute("download",l),u.href=window.URL.createObjectURL(o),u.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u)},e.upload=function(e){if(void 0!=e&&void 0!=e.target&&0!=e.target.files.length){var r=e.target.files[0],a=r.name;console.log(a),c.readAsText(r)}},e.addcard=function(r,a){var l,n=(new Date).getTime();console.log(a),(l=a?t.CopyByValue(t.Const.card_template):t.CopyByValue(e.cards[r])).id=n,console.log(l),e.cards.splice(r+1,0,l)},e.removecard=function(r){if(1==e.cards.length){var a=e.cards[0].id;e.cards[0]=t.CopyByValue(t.Const.card_template),e.cards[0].id=a}else e.cards.splice(r,1)},e.$watch("cards",function(){var r=t.Arrangeable(e.cards,e.characters);n.toggle_alert(e,null===r,r),e.cardcount=e.cards.length},!0),e.init()}]),u.directive("customFileChange",function(){return{restict:"A",link:function(e,r,a){var t=e.$eval(a.customFileChange);r.on("change",t)}}}),u.directive("optionValue",function(){return{require:"ngModel",link:function(e,r,a,t){t.$parsers.push(function(e){return null!=e?parseInt(e,10):null}),t.$formatters.push(function(e){return null!=e?""+e:null})}}}),u.filter("floor",function(){return function(e){return Math.floor(e)}}),window.onload=function(){$(".loading").slideUp(500)},$(document).ready(function(){$("#cardcount").keyup(function(e){13==e.keyCode&&$(this).blur()})})},function(e,r,a){e.exports=a(4)}]);